## CMCC RX30算力版23.05到24.10升级

2025-01 RX30安装了定制uboot和immoralwrt 23.05版，时间来到2026年，一年以后一些App已经不在23.05上更新而是转向主线24.10.是时候升级24.10继续App的更新了。

之前安装的是lgs2007m的uboot，文档中提到可以支持legacy（bin格式image）和openwrt/immortalwrt主线FIP（itb格式image）。在恩山论坛的无线路由板块lgs2007m也在一个帖子里提到：
我改的uboot和gpt目前已同时支持21.02闭源固件(.bin格式Legacy image)和openwrt、immortalwrt主线master/23.05分支固件(.itb格式FIT image)直接刷入启动，可在SSH修改环境变量，直接切换启动两种固件，无需重刷，配置保留。
最新24.10没试过，应该也可以启动。

那么什么是SSH环境变量呢？以下是lgs2007m原文档里的表述：
uboot刷机是不保留配置的，如果已经刷好两种固件不想重刷，可以在系统里修改环境变量，重启即可切换启动的固件，配置保留。
当前在openwrt、immortalwrt主线master/23.05分支固件(.itb格式FIT image)，要切换到闭源固件(.bin格式Legacy image)
运行下面命令修改环境变量，没有报错即可，然后reboot重启
```
cp /etc/fw_env.config /etc/fw_env.config.bak
echo -e "/dev/mmcblk0p1 0 0x80000" > /etc/fw_env.config
fw_setenv dual_boot.current_slot 0
cp /etc/fw_env.config.bak /etc/fw_env.config
```
当前在闭源固件(.bin格式Legacy image)，要切换到openwrt、immortalwrt主线master/23.05分支固件(.itb格式FIT image)
运行下面命令修改环境变量，没有报错即可，然后reboot重启
```
fw_setenv dual_boot.current_slot 1
```
但文中也提到了CMCC RX30的一个问题：

直接uboot刷闭源固件(.bin格式Legacy image)或者openwrt、immortalwrt主线master/23.05分支固件(.itb格式FIT image)，可以直接启动。
【注意】openwrt、immortalwrt主线master/23.05分支固件(.itb格式FIT image)固件第一次启动有点慢，特别是集成docker的固件，第一次启动可能需要5分钟，耐心等待，后面再启动就快了。
【注意】由于主线RAX3000M-NAND和RAX3000M-eMMC使用all in fit，一个固件集合了NAND和eMMC固件，启动时需要选择对应的fdt才可正常启动eMMC的固件。我已通过uboot自动判断，如果从kernel分区启动闭源固件(.bin格式Legacy image)则删除这个环境变量，如果从production分区启动主线master/23.05分支固件(.itb格式FIT image)，则设置bootconf config-1#mt7981b-cmcc-rax3000m-emmc，这个是自动的。
【注意】主线目前还没有XR30和RAX3000Z增强版（XR30-eMMC）支持，所以我设置bootconf直接使用config-1#mt7981b-cmcc-rax3000m-emmc，能支持主线RAX3000M-eMMC固件启动，但主线支持XR30-eMMC后是不能启动的，得修改uboot源码，改这个bootconf设置。XR30-eMMC比RAX3000M-eMMC少一个LED，XR30-eMMC的eMMC可以跑52MHz，RAX3000M-eMMC的eMMC跑26MHz。
